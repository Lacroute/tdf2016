webpackJsonp([1,0],[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var n=a(1),c=r(n),i=a(13),o=r(i);new c["default"]({el:"body",components:{App:o["default"]}})},,function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(15),c=r(n);t["default"]={components:{Tdf:c["default"]}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={name:"Race",props:{race:Object},methods:{raceSelected:function(e){this.$dispatch("race-selected",this.race)}}}},function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(14),c=r(n),i=a(9),o=a(5),s=a(1);s.use(a(16));var l,u,d,p=430,f=100,h=o.scale.linear().range([0,p]),g=o.scale.linear().range([f,0]),v=o.svg.line().x(function(e,t){return h(t)}).y(function(e){return g(+e[2])});t["default"]={name:"Tdf",components:{Race:c["default"]},data:function(){return{races:[],currentRace:null}},computed:{previousRace:function(){if(this.currentRace)return this.currentRace.stage-1},nextRace:function(){if(this.currentRace)return this.currentRace.stage+1},elevation:function(){return this.currentRace.data.elevation[1]-this.currentRace.data.elevation[0]}},ready:function(){this.$http.get("static/tdf2016.geojson").then(function(e){this.jsonReady(JSON.parse(e.body))},function(e){console.log(e)}),l=i.map("mapid").setView([46,2],6),i.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:13,id:"mapbox.light",accessToken:"pk.eyJ1IjoibGFjcm91dGUiLCJhIjoiY2lxcDhoZXpqMDA1M2h4bms4YWRyNGlzbiJ9.VLlfBQGaxNFE9M_Ug3YXhQ"}).addTo(l)},methods:{defaultStyle:function(){return{color:"#000",weight:5,opacity:.4}},defaultStyleCircle:function(e,t){return{color:"#333",fillColor:"#000",fillOpacity:.3}},hightlightStyle:function(){return{color:"#f5da3f",weight:3,opacity:1}},hightlightStyleCircleStart:function(){return{color:"#00A388",fillColor:"#79BD8F",fillOpacity:.8}},hightlightStyleCircleEnd:function(){return{color:"#CD2C24",fillColor:"#F2836B",fillOpacity:.8}},getStageFromName:function(e){return parseInt(e.match(/Stage [0-9]+/)[0].replace(/\D/g,""))},jsonReady:function(e){var t=this,a=this;this.races=[],this.currentRace=null,u=i.geoJson(e,{onEachFeature:function(e,t){var r=e.properties.name,n=a.getStageFromName(r),c=r.match(/[0-9]+ km/)[0].replace(/\D/g,"");r=r.split(":")[1];var i=r.split("km")[1],o=e.geometry.coordinates,s=o[0],l=o[o.length-1],u=a.arrayMinMax(e.geometry.coordinates),d={stage:n,data:{raw:r,name:i,distance:parseInt(c),elevation:u},start:s,end:l,selected:!1};d.start.circle=a.circleFactory(d.start,a.defaultStyleCircle()),d.end.circle=a.circleFactory(d.end,a.defaultStyleCircle()),a.races.push(d),t.on({click:function(e){var t=a.getStageFromName(e.target.feature.properties.name);a.highlightFeature(t)}})},style:this.defaultStyle}).addTo(l);var r=u._layers,n=function(e){var a=r[e],n=a._leaflet_id,c=t.getStageFromName(a.feature.properties.name),i=t.races.find(function(e){return e.stage===c});i.layerId=n};for(var c in r)n(c);this.drawRaceSummary()},highlightFeature:function(e){this.currentRace=this.updateRaces(e),this.updateRaceSummary(),this.currentRace.start.circle.setStyle(this.hightlightStyleCircleStart()),this.currentRace.end.circle.setStyle(this.hightlightStyleCircleEnd()),this.updateCamera()},updateRaces:function(e){var t=void 0,a=this;return this.races.some(function(r){r.selected&&(u.getLayer(r.layerId).setStyle(a.defaultStyle()),r.start.circle.setStyle(a.defaultStyleCircle()),r.end.circle.setStyle(a.defaultStyleCircle()),r.selected=!1),r.stage===e&&(r.selected=!0,t=r,u.getLayer(t.layerId).setStyle(a.hightlightStyle()))}),t},drawRaceSummary:function(){var e=[[0,0,0]];d=o.select("#summary"),d.append("svg:path").attr("class","line-race").attr("d",v(e))},updateRaceSummary:function(){var e=u.getLayer(this.currentRace.layerId).feature.geometry.coordinates;h.domain([0,e.length]),g.domain([0,this.currentRace.data.elevation[1]]),d.select("path.line-race").transition().attr("d",v(e)).duration(300)},updateCamera:function(){var e=i.latLngBounds(i.latLng(this.currentRace.start[1],this.currentRace.start[0]),i.latLng(this.currentRace.end[1],this.currentRace.end[0]));l.fitBounds(e,{maxZoom:10,animate:!0,paddingTopLeft:[300,300],paddingBottomRight:[0,200]})},circleFactory:function(e,t){return i.circle([e[1],e[0]],500,t).addTo(l)},arrayMinMax:function(e){for(var t=e.length,a=1/0,r=-(1/0),n=void 0;t--;)n=e[t][2],n<a&&(a=n),n>r&&(r=n);return[a,r]}},events:{"race-selected":function(e){this.highlightFeature(e.stage)}}}},,function(e,t){},function(e,t){},function(e,t){},,function(e,t){e.exports=" <tdf></tdf> "},function(e,t){e.exports=' <div class=race-selector v-if="currentRace != null"> <race v-for="race in races | orderBy \'stage\'" :race=race> </race> </div> <section class=race-overview> <header> <div v-if="currentRace != null"> <div class=navigator> <p v-show="previousRace > 0" v-on:click=highlightFeature(previousRace)> Étape {{ previousRace }} ← </p> <p v-show="nextRace <= races.length" v-on:click=highlightFeature(nextRace)> → Étape {{ nextRace }} </p> </div> <p> Étape {{ currentRace.stage }} <span>{{ currentRace.data.name }}<span> </span></span></p> </div> <div v-else class=start> <p v-on:click=highlightFeature(1)> Tour de France 2016 <span>Cliquez pour commencer</span> </p> </div> </header> <div class=race-details v-show="currentRace != null"> <span v-if="currentRace != null"> Distance {{ currentRace.data.distance }} km </span> <span v-if="currentRace != null"> Dénivelé max {{ elevation }} m </span> <svg id=summary></svg> </div> </section> <div id=mapid></div> '},function(e,t){e.exports=' <div v-bind:class="{ \'active\': race.selected }" v-on:click=raceSelected _v-e1b8c030=""> Étape {{ race.stage }} : {{ race.data.name }} </div> '},function(e,t,a){var r,n;a(6),r=a(2),n=a(10),e.exports=r||{},e.exports.__esModule&&(e.exports=e.exports["default"]),n&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=n)},function(e,t,a){var r,n;a(8),r=a(3),n=a(12),e.exports=r||{},e.exports.__esModule&&(e.exports=e.exports["default"]),n&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=n)},function(e,t,a){var r,n;a(7),r=a(4),n=a(11),e.exports=r||{},e.exports.__esModule&&(e.exports=e.exports["default"]),n&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=n)}]);
//# sourceMappingURL=app.a98374092f69d8ee9608.js.map