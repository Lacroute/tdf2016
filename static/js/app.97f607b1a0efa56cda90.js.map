{"version":3,"sources":["webpack:///static/js/app.97f607b1a0efa56cda90.js","webpack:///./src/main.js","webpack:///App.vue","webpack:///Race.vue","webpack:///Tdf.vue","webpack:///./src/App.vue?d818","webpack:///./src/components/Tdf.vue?0e48","webpack:///./src/components/Race.vue?2e51","webpack:///./src/App.vue","webpack:///./src/components/Race.vue","webpack:///./src/components/Tdf.vue"],"names":["webpackJsonp","module","exports","__webpack_require__","_interopRequireDefault","obj","__esModule","default","_vue","_vue2","_App","_App2","el","components","App","Object","defineProperty","value","_Tdf","_Tdf2","Tdf","name","props","race","methods","raceSelected","e","this","$dispatch","_Race","_Race2","L","d3","Vue","use","map","layerGroup","svg","width","height","x","scale","linear","range","y","valueLine","line","d","i","Race","data","races","currentRace","computed","previousRace","stage","nextRace","elevation","ready","$http","get","then","jsonReady","JSON","parse","body","error","console","log","setView","tileLayer","attribution","maxZoom","id","accessToken","addTo","defaultStyle","color","weight","opacity","defaultStyleCircle","c","f","fillColor","fillOpacity","hightlightStyle","hightlightStyleCircleStart","hightlightStyleCircleEnd","getStageFromName","parseInt","match","replace","tdf","_this","that","geoJson","onEachFeature","feature","layer","featureName","properties","distance","split","coords","geometry","coordinates","start","end","length","arrayMinMax","raw","selected","circle","circleFactory","push","on","click","target","highlightFeature","style","l","_layers","minElevation","Infinity","maxElevation","_loop","layerId","_leaflet_id","find","r","domain","drawRaceSummary","updateRaces","updateRaceSummary","setStyle","updateCamera","some","getLayer","select","yAxis","axis","orient","ticks","tickSize","append","attr","call","selectAll","transition","duration","bounds","latLngBounds","latLng","fitBounds","animate","paddingTopLeft","paddingBottomRight","arr","len","min","max","cell","events","race-selected","__vue_script__","__vue_template__","options","template"],"mappings":"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","file":"static/js/app.97f607b1a0efa56cda90.js","sourcesContent":["webpackJsonp([1,0],[\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _vue = __webpack_require__(1);\n\t\n\tvar _vue2 = _interopRequireDefault(_vue);\n\t\n\tvar _App = __webpack_require__(13);\n\t\n\tvar _App2 = _interopRequireDefault(_App);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tnew _vue2.default({\n\t  el: 'body',\n\t  components: { App: _App2.default }\n\t});\n\n/***/ },\n/* 1 */,\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _Tdf = __webpack_require__(15);\n\t\n\tvar _Tdf2 = _interopRequireDefault(_Tdf);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.default = {\n\t  components: {\n\t    Tdf: _Tdf2.default\n\t  }\n\t};\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = {\n\t  name: 'Race',\n\t\n\t  props: {\n\t    race: Object\n\t  },\n\t\n\t  methods: {\n\t    raceSelected: function raceSelected(e) {\n\t      this.$dispatch('race-selected', this.race);\n\t    }\n\t  }\n\t};\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _Race = __webpack_require__(14);\n\t\n\tvar _Race2 = _interopRequireDefault(_Race);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar L = __webpack_require__(9);\n\tvar d3 = __webpack_require__(5);\n\tvar Vue = __webpack_require__(1);\n\tVue.use(__webpack_require__(16));\n\tvar map;\n\tvar layerGroup;\n\t\n\tvar svg;\n\tvar width = 390;\n\tvar height = 100;\n\tvar x = d3.scale.linear().range([40, width]);\n\t\n\tvar y = d3.scale.linear().range([height, 0]);\n\t\n\tvar valueLine = d3.svg.line().x(function (d, i) {\n\t  return x(i);\n\t}).y(function (d) {\n\t  return y(+d[2]);\n\t});\n\texports.default = {\n\t  name: 'Tdf',\n\t  components: { Race: _Race2.default },\n\t\n\t  data: function data() {\n\t    return {\n\t      races: [],\n\t      currentRace: null\n\t    };\n\t  },\n\t\n\t\n\t  computed: {\n\t    previousRace: function previousRace() {\n\t      if (this.currentRace) return this.currentRace.stage - 1;\n\t    },\n\t\n\t    nextRace: function nextRace() {\n\t      if (this.currentRace) return this.currentRace.stage + 1;\n\t    },\n\t\n\t    elevation: function elevation() {\n\t      return this.currentRace.data.elevation[1] - this.currentRace.data.elevation[0];\n\t    }\n\t  },\n\t\n\t  ready: function ready() {\n\t    this.$http.get('static/tdf2016.geojson').then(function (data) {\n\t      this.jsonReady(JSON.parse(data.body));\n\t    }, function (error) {\n\t      console.log(error);\n\t    });\n\t\n\t    map = L.map('mapid').setView([46, 2], 6);\n\t\n\t    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {\n\t      attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"http://mapbox.com\">Mapbox</a>',\n\t      maxZoom: 13,\n\t      id: 'mapbox.light',\n\t      accessToken: 'pk.eyJ1IjoibGFjcm91dGUiLCJhIjoiY2lxcDhoZXpqMDA1M2h4bms4YWRyNGlzbiJ9.VLlfBQGaxNFE9M_Ug3YXhQ'\n\t    }).addTo(map);\n\t  },\n\t\n\t  methods: {\n\t    defaultStyle: function defaultStyle() {\n\t      return {\n\t        color: '#000',\n\t        weight: 5,\n\t        opacity: 0.4\n\t      };\n\t    },\n\t\n\t    defaultStyleCircle: function defaultStyleCircle(c, f) {\n\t      return {\n\t        color: '#333',\n\t        fillColor: '#000',\n\t        fillOpacity: 0.3\n\t      };\n\t    },\n\t\n\t    hightlightStyle: function hightlightStyle() {\n\t      return {\n\t        color: '#f5da3f',\n\t        weight: 3,\n\t        opacity: 1\n\t      };\n\t    },\n\t\n\t    hightlightStyleCircleStart: function hightlightStyleCircleStart() {\n\t      return {\n\t        color: '#00A388',\n\t        fillColor: '#79BD8F',\n\t        fillOpacity: 0.8\n\t      };\n\t    },\n\t\n\t    hightlightStyleCircleEnd: function hightlightStyleCircleEnd() {\n\t      return {\n\t        color: '#CD2C24',\n\t        fillColor: '#F2836B',\n\t        fillOpacity: 0.8\n\t      };\n\t    },\n\t\n\t    getStageFromName: function getStageFromName(name) {\n\t      return parseInt(name.match(/Stage [0-9]+/)[0].replace(/\\D/g, ''));\n\t    },\n\t\n\t    jsonReady: function jsonReady(tdf) {\n\t      var _this = this;\n\t\n\t      var that = this;\n\t\n\t      this.races = [];\n\t      this.currentRace = null;\n\t\n\t      layerGroup = L.geoJson(tdf, {\n\t        onEachFeature: function onEachFeature(feature, layer) {\n\t          var featureName = feature.properties.name;\n\t          var stage = that.getStageFromName(featureName);\n\t          var distance = featureName.match(/[0-9]+ km/)[0].replace(/\\D/g, '');\n\t          featureName = featureName.split(':')[1];\n\t          var name = featureName.split('km')[1];\n\t          var coords = feature.geometry.coordinates;\n\t          var start = coords[0];\n\t          var end = coords[coords.length - 1];\n\t          var elevation = that.arrayMinMax(feature.geometry.coordinates);\n\t\n\t          var race = {\n\t            stage: stage,\n\t            data: {\n\t              raw: featureName,\n\t              name: name,\n\t              distance: parseInt(distance),\n\t              elevation: elevation\n\t            },\n\t            start: start,\n\t            end: end,\n\t            selected: false\n\t          };\n\t\n\t          race.start.circle = that.circleFactory(race.start, that.defaultStyleCircle());\n\t          race.end.circle = that.circleFactory(race.end, that.defaultStyleCircle());\n\t\n\t          that.races.push(race);\n\t\n\t          layer.on({\n\t            'click': function click(e) {\n\t              var stage = that.getStageFromName(e.target.feature.properties.name);\n\t              that.highlightFeature(stage);\n\t            }\n\t          });\n\t        },\n\t\n\t        style: this.defaultStyle\n\t      }).addTo(map);\n\t\n\t      var l = layerGroup._layers;\n\t      var minElevation = Infinity;\n\t      var maxElevation = -Infinity;\n\t\n\t      var _loop = function _loop(i) {\n\t        var layer = l[i];\n\t        var layerId = layer._leaflet_id;\n\t        var stage = _this.getStageFromName(layer.feature.properties.name);\n\t\n\t        var race = _this.races.find(function (r) {\n\t          return r.stage === stage;\n\t        });\n\t        if (race.data.elevation[0] < minElevation) {\n\t          minElevation = race.data.elevation[0];\n\t        }\n\t        if (race.data.elevation[1] > maxElevation) {\n\t          maxElevation = race.data.elevation[1];\n\t        }\n\t        race.layerId = layerId;\n\t      };\n\t\n\t      for (var i in l) {\n\t        _loop(i);\n\t      }\n\t\n\t      y.domain([minElevation, maxElevation]);\n\t      this.drawRaceSummary();\n\t    },\n\t\n\t    highlightFeature: function highlightFeature(stage) {\n\t      this.currentRace = this.updateRaces(stage);\n\t      this.updateRaceSummary();\n\t      this.currentRace.start.circle.setStyle(this.hightlightStyleCircleStart());\n\t      this.currentRace.end.circle.setStyle(this.hightlightStyleCircleEnd());\n\t      this.updateCamera();\n\t    },\n\t\n\t    updateRaces: function updateRaces(stage) {\n\t      var r = void 0;\n\t      var that = this;\n\t      this.races.some(function (race) {\n\t        if (race.selected) {\n\t          layerGroup.getLayer(race.layerId).setStyle(that.defaultStyle());\n\t          race.start.circle.setStyle(that.defaultStyleCircle());\n\t          race.end.circle.setStyle(that.defaultStyleCircle());\n\t          race.selected = false;\n\t        }\n\t        if (race.stage === stage) {\n\t          race.selected = true;\n\t          r = race;\n\t          layerGroup.getLayer(r.layerId).setStyle(that.hightlightStyle());\n\t        }\n\t      });\n\t\n\t      return r;\n\t    },\n\t\n\t    drawRaceSummary: function drawRaceSummary() {\n\t      var coords = [[0, 0, 0]];\n\t\n\t      svg = d3.select('#summary');\n\t\n\t      var yAxis = d3.svg.axis().scale(y).orient('left').ticks(3, ' m').tickSize(6, 0);\n\t\n\t      svg.append('g').attr('class', 'y-axis').attr('transform', 'translate(40, 0)').call(yAxis).selectAll('text').attr('transform', 'translate(0, -7)');\n\t\n\t      svg.append('svg:path').attr('class', 'line-race').attr('d', valueLine(coords));\n\t    },\n\t\n\t    updateRaceSummary: function updateRaceSummary() {\n\t      var coords = layerGroup.getLayer(this.currentRace.layerId).feature.geometry.coordinates;\n\t\n\t      x.domain([0, coords.length]);\n\t\n\t      svg.select('path.line-race').transition().attr('d', valueLine(coords)).duration(300);\n\t    },\n\t\n\t    updateCamera: function updateCamera() {\n\t      var bounds = L.latLngBounds(L.latLng(this.currentRace.start[1], this.currentRace.start[0]), L.latLng(this.currentRace.end[1], this.currentRace.end[0]));\n\t\n\t      map.fitBounds(bounds, {\n\t        maxZoom: 10,\n\t        animate: true,\n\t        paddingTopLeft: [300, 300],\n\t        paddingBottomRight: [0, 200]\n\t      });\n\t    },\n\t\n\t    circleFactory: function circleFactory(coords, style) {\n\t      return L.circle([coords[1], coords[0]], 500, style).addTo(map);\n\t    },\n\t\n\t    arrayMinMax: function arrayMinMax(arr) {\n\t      var len = arr.length;\n\t      var min = Infinity;\n\t      var max = -Infinity;\n\t      var cell = void 0;\n\t\n\t      while (len--) {\n\t        cell = arr[len][2];\n\t        if (cell < min) {\n\t          min = cell;\n\t        }\n\t        if (cell > max) {\n\t          max = cell;\n\t        }\n\t      }\n\t\n\t      return [min, max];\n\t    }\n\t  },\n\t\n\t  events: {\n\t    'race-selected': function raceSelected(race) {\n\t      this.highlightFeature(race.stage);\n\t    }\n\t  }\n\t};\n\n/***/ },\n/* 5 */,\n/* 6 */\n/***/ function(module, exports) {\n\n\t// removed by extract-text-webpack-plugin\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n\t// removed by extract-text-webpack-plugin\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\t// removed by extract-text-webpack-plugin\n\n/***/ },\n/* 9 */,\n/* 10 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \" <tdf></tdf> \";\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \" <div class=race-selector v-if=\\\"currentRace != null\\\"> <race v-for=\\\"race in races | orderBy 'stage'\\\" :race=race> </race> </div> <section class=race-overview> <header> <div v-if=\\\"currentRace != null\\\"> <div class=navigator> <p v-show=\\\"previousRace > 0\\\" v-on:click=highlightFeature(previousRace)> Étape {{ previousRace }} ← </p> <p v-show=\\\"nextRace <= races.length\\\" v-on:click=highlightFeature(nextRace)> → Étape {{ nextRace }} </p> </div> <p> Étape {{ currentRace.stage }} <span>{{ currentRace.data.name }}<span> </span></span></p> </div> <div v-else class=start> <p v-on:click=highlightFeature(1)> Tour de France 2016 <span>Cliquez pour commencer</span> </p> </div> </header> <div class=race-details v-show=\\\"currentRace != null\\\"> <span v-if=\\\"currentRace != null\\\"> Distance {{ currentRace.data.distance }} km </span> <span v-if=\\\"currentRace != null\\\"> Dénivelé max {{ elevation }} m </span> <svg id=summary></svg> </div> </section> <div id=mapid></div> \";\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \" <div v-bind:class=\\\"{ 'active': race.selected }\\\" v-on:click=raceSelected _v-e1b8c030=\\\"\\\"> Étape {{ race.stage }} : {{ race.data.name }} </div> \";\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __vue_script__, __vue_template__\n\t__webpack_require__(6)\n\t__vue_script__ = __webpack_require__(2)\n\t__vue_template__ = __webpack_require__(10)\n\tmodule.exports = __vue_script__ || {}\n\tif (module.exports.__esModule) module.exports = module.exports.default\n\tif (__vue_template__) {\n\t(typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports).template = __vue_template__\n\t}\n\n\n/***/ },\n/* 14 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __vue_script__, __vue_template__\n\t__webpack_require__(8)\n\t__vue_script__ = __webpack_require__(3)\n\t__vue_template__ = __webpack_require__(12)\n\tmodule.exports = __vue_script__ || {}\n\tif (module.exports.__esModule) module.exports = module.exports.default\n\tif (__vue_template__) {\n\t(typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports).template = __vue_template__\n\t}\n\n\n/***/ },\n/* 15 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __vue_script__, __vue_template__\n\t__webpack_require__(7)\n\t__vue_script__ = __webpack_require__(4)\n\t__vue_template__ = __webpack_require__(11)\n\tmodule.exports = __vue_script__ || {}\n\tif (module.exports.__esModule) module.exports = module.exports.default\n\tif (__vue_template__) {\n\t(typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports).template = __vue_template__\n\t}\n\n\n/***/ }\n]);\n\n\n/** WEBPACK FOOTER **\n ** static/js/app.97f607b1a0efa56cda90.js\n **/","import Vue from 'vue'\nimport App from './App'\n\n/* eslint-disable no-new */\nnew Vue({\n  el: 'body',\n  components: { App }\n})\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/main.js\n **/","<template>\n  <tdf></tdf>\n</template>\n\n<script>\nimport Tdf from './components/Tdf'\n\nexport default {\n  components: {\n    Tdf\n  }\n}\n</script>\n\n<style>\nhtml {\n  height: 100%;\n}\n\nbody {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  margin: 0;\n  padding: 0;\n}\n\n/***************/\n/* LEAFLET.CSS */\n/***************/\n\n/* required styles */\n\n.leaflet-map-pane,\n.leaflet-tile,\n.leaflet-marker-icon,\n.leaflet-marker-shadow,\n.leaflet-tile-pane,\n.leaflet-tile-container,\n.leaflet-overlay-pane,\n.leaflet-shadow-pane,\n.leaflet-marker-pane,\n.leaflet-popup-pane,\n.leaflet-overlay-pane svg,\n.leaflet-zoom-box,\n.leaflet-image-layer,\n.leaflet-layer {\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\t}\n.leaflet-container {\n\toverflow: hidden;\n\t-ms-touch-action: none;\n\ttouch-action: none;\n\t}\n.leaflet-tile,\n.leaflet-marker-icon,\n.leaflet-marker-shadow {\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t        user-select: none;\n\t-webkit-user-drag: none;\n\t}\n.leaflet-marker-icon,\n.leaflet-marker-shadow {\n\tdisplay: block;\n\t}\n/* map is broken in FF if you have max-width: 100% on tiles */\n.leaflet-container img {\n\tmax-width: none !important;\n\t}\n/* stupid Android 2 doesn't understand \"max-width: none\" properly */\n.leaflet-container img.leaflet-image-layer {\n\tmax-width: 15000px !important;\n\t}\n.leaflet-tile {\n\tfilter: inherit;\n\tvisibility: hidden;\n\t}\n.leaflet-tile-loaded {\n\tvisibility: inherit;\n\t}\n.leaflet-zoom-box {\n\twidth: 0;\n\theight: 0;\n\t}\n/* workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=888319 */\n.leaflet-overlay-pane svg {\n\t-moz-user-select: none;\n\t}\n\n.leaflet-tile-pane    { z-index: 2; }\n.leaflet-objects-pane { z-index: 3; }\n.leaflet-overlay-pane { z-index: 4; }\n.leaflet-shadow-pane  { z-index: 5; }\n.leaflet-marker-pane  { z-index: 6; }\n.leaflet-popup-pane   { z-index: 7; }\n\n.leaflet-vml-shape {\n\twidth: 1px;\n\theight: 1px;\n\t}\n.lvml {\n\tbehavior: url(#default#VML);\n\tdisplay: inline-block;\n\tposition: absolute;\n\t}\n\n\n/* control positioning */\n\n.leaflet-control {\n\tposition: relative;\n\tz-index: 7;\n\tpointer-events: auto;\n\t}\n.leaflet-top,\n.leaflet-bottom {\n\tposition: absolute;\n\tz-index: 1000;\n\tpointer-events: none;\n\t}\n.leaflet-top {\n\ttop: 0;\n\t}\n.leaflet-right {\n\tright: 0;\n\t}\n.leaflet-bottom {\n\tbottom: 0;\n\t}\n.leaflet-left {\n\tleft: 0;\n\t}\n.leaflet-control {\n\tfloat: left;\n\tclear: both;\n\t}\n.leaflet-right .leaflet-control {\n\tfloat: right;\n\t}\n.leaflet-top .leaflet-control {\n\tmargin-top: 10px;\n\t}\n.leaflet-bottom .leaflet-control {\n\tmargin-bottom: 10px;\n\t}\n.leaflet-left .leaflet-control {\n\tmargin-left: 10px;\n\t}\n.leaflet-right .leaflet-control {\n\tmargin-right: 10px;\n\t}\n\n\n/* zoom and fade animations */\n\n.leaflet-fade-anim .leaflet-tile,\n.leaflet-fade-anim .leaflet-popup {\n\topacity: 0;\n\t-webkit-transition: opacity 0.2s linear;\n\t   -moz-transition: opacity 0.2s linear;\n\t     -o-transition: opacity 0.2s linear;\n\t        transition: opacity 0.2s linear;\n\t}\n.leaflet-fade-anim .leaflet-tile-loaded,\n.leaflet-fade-anim .leaflet-map-pane .leaflet-popup {\n\topacity: 1;\n\t}\n\n.leaflet-zoom-anim .leaflet-zoom-animated {\n\t-webkit-transition: -webkit-transform 0.25s cubic-bezier(0,0,0.25,1);\n\t   -moz-transition:    -moz-transform 0.25s cubic-bezier(0,0,0.25,1);\n\t     -o-transition:      -o-transform 0.25s cubic-bezier(0,0,0.25,1);\n\t        transition:         transform 0.25s cubic-bezier(0,0,0.25,1);\n\t}\n.leaflet-zoom-anim .leaflet-tile,\n.leaflet-pan-anim .leaflet-tile,\n.leaflet-touching .leaflet-zoom-animated {\n\t-webkit-transition: none;\n\t   -moz-transition: none;\n\t     -o-transition: none;\n\t        transition: none;\n\t}\n\n.leaflet-zoom-anim .leaflet-zoom-hide {\n\tvisibility: hidden;\n\t}\n\n\n/* cursors */\n\n.leaflet-clickable {\n\tcursor: pointer;\n\t}\n.leaflet-container {\n\tcursor: -webkit-grab;\n\tcursor:    -moz-grab;\n\t}\n.leaflet-popup-pane,\n.leaflet-control {\n\tcursor: auto;\n\t}\n.leaflet-dragging .leaflet-container,\n.leaflet-dragging .leaflet-clickable {\n\tcursor: move;\n\tcursor: -webkit-grabbing;\n\tcursor:    -moz-grabbing;\n\t}\n\n\n/* visual tweaks */\n\n.leaflet-container {\n\tbackground: #ddd;\n\toutline: 0;\n\t}\n.leaflet-container a {\n\tcolor: #0078A8;\n\t}\n.leaflet-container a.leaflet-active {\n\toutline: 2px solid orange;\n\t}\n.leaflet-zoom-box {\n\tborder: 2px dotted #38f;\n\tbackground: rgba(255,255,255,0.5);\n\t}\n\n\n/* general typography */\n.leaflet-container {\n\tfont: 12px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif;\n\t}\n\n\n/* general toolbar styles */\n\n.leaflet-bar {\n\tbox-shadow: 0 1px 5px rgba(0,0,0,0.65);\n\tborder-radius: 4px;\n\t}\n.leaflet-bar a,\n.leaflet-bar a:hover {\n\tbackground-color: #fff;\n\tborder-bottom: 1px solid #ccc;\n\twidth: 26px;\n\theight: 26px;\n\tline-height: 26px;\n\tdisplay: block;\n\ttext-align: center;\n\ttext-decoration: none;\n\tcolor: black;\n\t}\n.leaflet-bar a,\n.leaflet-control-layers-toggle {\n\tbackground-position: 50% 50%;\n\tbackground-repeat: no-repeat;\n\tdisplay: block;\n\t}\n.leaflet-bar a:hover {\n\tbackground-color: #f4f4f4;\n\t}\n.leaflet-bar a:first-child {\n\tborder-top-left-radius: 4px;\n\tborder-top-right-radius: 4px;\n\t}\n.leaflet-bar a:last-child {\n\tborder-bottom-left-radius: 4px;\n\tborder-bottom-right-radius: 4px;\n\tborder-bottom: none;\n\t}\n.leaflet-bar a.leaflet-disabled {\n\tcursor: default;\n\tbackground-color: #f4f4f4;\n\tcolor: #bbb;\n\t}\n\n.leaflet-touch .leaflet-bar a {\n\twidth: 30px;\n\theight: 30px;\n\tline-height: 30px;\n\t}\n\n\n/* zoom control */\n\n.leaflet-control-zoom-in,\n.leaflet-control-zoom-out {\n\tfont: bold 18px 'Lucida Console', Monaco, monospace;\n\ttext-indent: 1px;\n\t}\n.leaflet-control-zoom-out {\n\tfont-size: 20px;\n\t}\n\n.leaflet-touch .leaflet-control-zoom-in {\n\tfont-size: 22px;\n\t}\n.leaflet-touch .leaflet-control-zoom-out {\n\tfont-size: 24px;\n\t}\n\n\n/* layers control */\n\n.leaflet-control-layers {\n\tbox-shadow: 0 1px 5px rgba(0,0,0,0.4);\n\tbackground: #fff;\n\tborder-radius: 5px;\n\t}\n.leaflet-control-layers-toggle {\n\tbackground-image: url(http://cdn.leafletjs.com/leaflet/v0.7.7/images/layers.png);\n\twidth: 36px;\n\theight: 36px;\n\t}\n.leaflet-retina .leaflet-control-layers-toggle {\n\tbackground-image: url(http://cdn.leafletjs.com/leaflet/v0.7.7/images/layers-2x.png);\n\tbackground-size: 26px 26px;\n\t}\n.leaflet-touch .leaflet-control-layers-toggle {\n\twidth: 44px;\n\theight: 44px;\n\t}\n.leaflet-control-layers .leaflet-control-layers-list,\n.leaflet-control-layers-expanded .leaflet-control-layers-toggle {\n\tdisplay: none;\n\t}\n.leaflet-control-layers-expanded .leaflet-control-layers-list {\n\tdisplay: block;\n\tposition: relative;\n\t}\n.leaflet-control-layers-expanded {\n\tpadding: 6px 10px 6px 6px;\n\tcolor: #333;\n\tbackground: #fff;\n\t}\n.leaflet-control-layers-selector {\n\tmargin-top: 2px;\n\tposition: relative;\n\ttop: 1px;\n\t}\n.leaflet-control-layers label {\n\tdisplay: block;\n\t}\n.leaflet-control-layers-separator {\n\theight: 0;\n\tborder-top: 1px solid #ddd;\n\tmargin: 5px -10px 5px -6px;\n\t}\n\n\n/* attribution and scale controls */\n\n.leaflet-container .leaflet-control-attribution {\n\tbackground: #fff;\n\tbackground: rgba(255, 255, 255, 0.7);\n\tmargin: 0;\n\t}\n.leaflet-control-attribution,\n.leaflet-control-scale-line {\n\tpadding: 0 5px;\n\tcolor: #333;\n\t}\n.leaflet-control-attribution a {\n\ttext-decoration: none;\n\t}\n.leaflet-control-attribution a:hover {\n\ttext-decoration: underline;\n\t}\n.leaflet-container .leaflet-control-attribution,\n.leaflet-container .leaflet-control-scale {\n\tfont-size: 11px;\n\t}\n.leaflet-left .leaflet-control-scale {\n\tmargin-left: 5px;\n\t}\n.leaflet-bottom .leaflet-control-scale {\n\tmargin-bottom: 5px;\n\t}\n.leaflet-control-scale-line {\n\tborder: 2px solid #777;\n\tborder-top: none;\n\tline-height: 1.1;\n\tpadding: 2px 5px 1px;\n\tfont-size: 11px;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\t-moz-box-sizing: content-box;\n\t     box-sizing: content-box;\n\n\tbackground: #fff;\n\tbackground: rgba(255, 255, 255, 0.5);\n\t}\n.leaflet-control-scale-line:not(:first-child) {\n\tborder-top: 2px solid #777;\n\tborder-bottom: none;\n\tmargin-top: -2px;\n\t}\n.leaflet-control-scale-line:not(:first-child):not(:last-child) {\n\tborder-bottom: 2px solid #777;\n\t}\n\n.leaflet-touch .leaflet-control-attribution,\n.leaflet-touch .leaflet-control-layers,\n.leaflet-touch .leaflet-bar {\n\tbox-shadow: none;\n\t}\n.leaflet-touch .leaflet-control-layers,\n.leaflet-touch .leaflet-bar {\n\tborder: 2px solid rgba(0,0,0,0.2);\n\tbackground-clip: padding-box;\n\t}\n\n\n/* popup */\n\n.leaflet-popup {\n\tposition: absolute;\n\ttext-align: center;\n\t}\n.leaflet-popup-content-wrapper {\n\tpadding: 1px;\n\ttext-align: left;\n\tborder-radius: 12px;\n\t}\n.leaflet-popup-content {\n\tmargin: 13px 19px;\n\tline-height: 1.4;\n\t}\n.leaflet-popup-content p {\n\tmargin: 18px 0;\n\t}\n.leaflet-popup-tip-container {\n\tmargin: 0 auto;\n\twidth: 40px;\n\theight: 20px;\n\tposition: relative;\n\toverflow: hidden;\n\t}\n.leaflet-popup-tip {\n\twidth: 17px;\n\theight: 17px;\n\tpadding: 1px;\n\n\tmargin: -10px auto 0;\n\n\t-webkit-transform: rotate(45deg);\n\t   -moz-transform: rotate(45deg);\n\t    -ms-transform: rotate(45deg);\n\t     -o-transform: rotate(45deg);\n\t        transform: rotate(45deg);\n\t}\n.leaflet-popup-content-wrapper,\n.leaflet-popup-tip {\n\tbackground: white;\n\n\tbox-shadow: 0 3px 14px rgba(0,0,0,0.4);\n\t}\n.leaflet-container a.leaflet-popup-close-button {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\tpadding: 4px 4px 0 0;\n\ttext-align: center;\n\twidth: 18px;\n\theight: 14px;\n\tfont: 16px/14px Tahoma, Verdana, sans-serif;\n\tcolor: #c3c3c3;\n\ttext-decoration: none;\n\tfont-weight: bold;\n\tbackground: transparent;\n\t}\n.leaflet-container a.leaflet-popup-close-button:hover {\n\tcolor: #999;\n\t}\n.leaflet-popup-scrolled {\n\toverflow: auto;\n\tborder-bottom: 1px solid #ddd;\n\tborder-top: 1px solid #ddd;\n\t}\n\n.leaflet-oldie .leaflet-popup-content-wrapper {\n\tzoom: 1;\n\t}\n.leaflet-oldie .leaflet-popup-tip {\n\twidth: 24px;\n\tmargin: 0 auto;\n\n\t-ms-filter: \"progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)\";\n\tfilter: progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678);\n\t}\n.leaflet-oldie .leaflet-popup-tip-container {\n\tmargin-top: -1px;\n\t}\n\n.leaflet-oldie .leaflet-control-zoom,\n.leaflet-oldie .leaflet-control-layers,\n.leaflet-oldie .leaflet-popup-content-wrapper,\n.leaflet-oldie .leaflet-popup-tip {\n\tborder: 1px solid #999;\n\t}\n\n\n/* div icon */\n\n.leaflet-div-icon {\n\tbackground: #fff;\n\tborder: 1px solid #666;\n\t}\n\n  /******************/\n  /* END LEAFLET.CSS*/\n  /******************/\n\n</style>\n\n\n\n/** WEBPACK FOOTER **\n ** App.vue?5cb46674\n **/","<template>\n  <div v-bind:class=\"{ 'active': race.selected }\" v-on:click=raceSelected>\n    Étape {{ race.stage }} : {{ race.data.name }}\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'Race',\n\n  props: {\n    race: Object\n  },\n\n  methods: {\n    raceSelected: function (e) {\n      this.$dispatch('race-selected', this.race)\n    }\n  }\n}\n</script>\n\n<style scoped>\ndiv{\n  color: #000;\n  font-family: 'Lato', sans-serif;\n  font-weight: 300;\n}\n.active {\n  background: #f5da3f;\n  font-weight: 700;\n}\n\ndiv:hover{\n  cursor: pointer;\n  background: rgba(255, 255, 0, 0.6);\n}\n</style>\n\n\n\n/** WEBPACK FOOTER **\n ** Race.vue?2a678f4b\n **/","<template>\n  <div class=\"race-selector\" v-if=\"currentRace != null\">\n    <race v-for=\"race in races | orderBy 'stage'\"\n      :race=\"race\">\n    </race>\n  </div>\n\n  <section class=\"race-overview\">\n    <header>\n      <div v-if=\"currentRace != null\">\n        <div class=\"navigator\">\n          <p\n            v-show=\"previousRace > 0\"\n            v-on:click=highlightFeature(previousRace) >\n            Étape {{ previousRace }} ←\n          </p>\n          <p v-show=\"nextRace <= races.length\" v-on:click=highlightFeature(nextRace)>\n            → Étape {{ nextRace }}\n          </p>\n        </div>\n\n        <p>\n          Étape {{ currentRace.stage }}\n          <span>{{ currentRace.data.name }}<span>\n        </p>\n      </div>\n      <div v-else class=\"start\">\n        <p v-on:click=highlightFeature(1)>\n          Tour de France 2016\n          <span>Cliquez pour commencer</span>\n        </p>\n      </div>\n    </header>\n    <div class=\"race-details\" v-show=\"currentRace != null\">\n      <span v-if=\"currentRace != null\">\n        Distance {{ currentRace.data.distance }} km\n      </span>\n      <span v-if=\"currentRace != null\">\n        Dénivelé max {{ elevation }} m\n      </span>\n      <svg id=\"summary\"></svg>\n    </div>\n  </section>\n  <div id=\"mapid\"></div>\n</template>\n\n<script>\nimport Race from './Race.vue'\n\nvar L = require('leaflet')\nvar d3 = require('d3')\nvar Vue = require('vue')\nVue.use(require('vue-resource'))\nvar map\nvar layerGroup\n\n// Make somme d3 global\nvar svg\nvar width = 390\nvar height = 100\nvar x = d3.scale.linear()\n  .range([40, width])\n\nvar y = d3.scale.linear()\n  .range([height, 0])\n\nvar valueLine = d3.svg.line()\n  .x(function (d, i) { return x(i) })\n  .y(function (d) { return y(+d[2]) })\n// END D3\n\nexport default {\n  name: 'Tdf',\n  components: {Race},\n\n  data () {\n    return {\n      races: [],\n      currentRace: null\n    }\n  },\n\n  computed: {\n    // Return the previous race\n    previousRace: function () {\n      if (this.currentRace) return this.currentRace.stage - 1\n    },\n\n    // Return the next race\n    nextRace: function () {\n      if (this.currentRace) return this.currentRace.stage + 1\n    },\n\n    elevation: function () {\n      return this.currentRace.data.elevation[1] - this.currentRace.data.elevation[0]\n    }\n  },\n\n  ready: function () {\n    // Get asynchronous data.\n    this.$http.get('static/tdf2016.geojson').then(\n      function (data) {\n        this.jsonReady(JSON.parse(data.body))\n      },\n      function (error) {\n        console.log(error)\n      }\n    )\n\n    // Build the map.\n    map = L.map('mapid').setView([46, 2], 6)\n\n    // Set custom tile layer from mapbox\n    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {\n      attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"http://mapbox.com\">Mapbox</a>',\n      maxZoom: 13,\n      id: 'mapbox.light',\n      accessToken: 'pk.eyJ1IjoibGFjcm91dGUiLCJhIjoiY2lxcDhoZXpqMDA1M2h4bms4YWRyNGlzbiJ9.VLlfBQGaxNFE9M_Ug3YXhQ'\n    }).addTo(map)\n  },\n\n  methods: {\n\n    // Defult style for the race vectors.\n    defaultStyle: function () {\n      return {\n        color: '#000',\n        weight: 5,\n        opacity: 0.4\n      }\n    },\n\n    // Default style for the cities\n    defaultStyleCircle: function (c, f) {\n      return {\n        color: '#333',\n        fillColor: '#000',\n        fillOpacity: 0.3\n      }\n    },\n\n    // When a race is on focus.\n    hightlightStyle: function () {\n      return {\n        color: '#f5da3f',\n        weight: 3,\n        opacity: 1\n      }\n    },\n\n    // Highlight city circle start\n    hightlightStyleCircleStart: function () {\n      return {\n        color: '#00A388',\n        fillColor: '#79BD8F',\n        fillOpacity: 0.8\n      }\n    },\n\n    // Highlight city circle end\n    hightlightStyleCircleEnd: function () {\n      return {\n        color: '#CD2C24',\n        fillColor: '#F2836B',\n        fillOpacity: 0.8\n      }\n    },\n\n    // Helper to extract the integer stage from the string name.\n    getStageFromName (name) {\n      return parseInt(name.match(/Stage [0-9]+/)[0].replace(/\\D/g, ''))\n    },\n\n    // When data is loaded.\n    jsonReady: function (tdf) {\n      // Reference to the component scope.\n      var that = this\n\n      // Hot reload fix\n      this.races = []\n      this.currentRace = null\n\n      // Draw the races.\n      layerGroup = L.geoJson(\n        tdf,\n        {\n          onEachFeature: function (feature, layer) {\n            // Clean data to build better format.\n            var featureName = feature.properties.name\n            var stage = that.getStageFromName(featureName)\n            var distance = featureName.match(/[0-9]+ km/)[0].replace(/\\D/g, '')\n            featureName = featureName.split(':')[1]\n            var name = featureName.split('km')[1]\n            var coords = feature.geometry.coordinates\n            var start = coords[0]\n            var end = coords[coords.length - 1]\n            let elevation = that.arrayMinMax(feature.geometry.coordinates)\n\n            // Store it.\n            let race = {\n              stage: stage,\n              data: {\n                raw: featureName,\n                name: name,\n                distance: parseInt(distance),\n                elevation: elevation\n              },\n              start: start,\n              end: end,\n              selected: false\n            }\n\n            // Draw default start and end circles.\n            race.start.circle = that.circleFactory(race.start, that.defaultStyleCircle())\n            race.end.circle = that.circleFactory(race.end, that.defaultStyleCircle())\n\n            that.races.push(race)\n\n            layer.on(\n              {\n                // highlight the race on click\n                'click': function (e) {\n                  var stage = that.getStageFromName(e.target.feature.properties.name)\n                  that.highlightFeature(stage)\n                }\n              })\n          },\n\n          style: this.defaultStyle\n        }\n      ).addTo(map)\n\n      // Iterate through the layer because the _leaflet_id is not readable in onEachFeature function\n      // Also get the min/max elevation value\n      let l = layerGroup._layers\n      let minElevation = Infinity\n      let maxElevation = -Infinity\n      for (let i in l) {\n        let layer = l[i]\n        let layerId = layer._leaflet_id\n        let stage = this.getStageFromName(layer.feature.properties.name)\n\n        let race = this.races.find(function (r) {\n          return r.stage === stage\n        })\n        if (race.data.elevation[0] < minElevation) {\n          minElevation = race.data.elevation[0]\n        }\n        if (race.data.elevation[1] > maxElevation) {\n          maxElevation = race.data.elevation[1]\n        }\n        race.layerId = layerId\n      }\n      // Init svg\n      y.domain([minElevation, maxElevation])\n      this.drawRaceSummary()\n    },\n\n    // Main function for higlighting.\n    highlightFeature: function (stage) {\n      this.currentRace = this.updateRaces(stage)\n      this.updateRaceSummary()\n      this.currentRace.start.circle.setStyle(this.hightlightStyleCircleStart())\n      this.currentRace.end.circle.setStyle(this.hightlightStyleCircleEnd())\n      this.updateCamera()\n    },\n\n    // Update all the races.\n    updateRaces: function (stage) {\n      let r\n      let that = this\n      this.races.some(function (race) {\n        if (race.selected) {\n          layerGroup.getLayer(race.layerId).setStyle(\n            that.defaultStyle()\n          )\n          race.start.circle.setStyle(that.defaultStyleCircle())\n          race.end.circle.setStyle(that.defaultStyleCircle())\n          race.selected = false\n        }\n        if (race.stage === stage) {\n          race.selected = true\n          r = race\n          layerGroup.getLayer(r.layerId).setStyle(\n            that.hightlightStyle()\n          )\n        }\n      })\n\n      return r\n    },\n\n    // Draw a graphic who summarize the race.\n    drawRaceSummary: function () {\n      var coords = [[0, 0, 0]]\n\n      svg = d3.select('#summary')\n\n      var yAxis = d3.svg.axis()\n        .scale(y)\n        .orient('left')\n        .ticks(3, ' m')\n        .tickSize(6, 0)\n\n      svg.append('g')\n        .attr('class', 'y-axis')\n        .attr('transform', 'translate(40, 0)')\n        .call(yAxis)\n        .selectAll('text')\n        .attr('transform', 'translate(0, -7)')\n\n      svg.append('svg:path')\n        .attr('class', 'line-race')\n        .attr('d', valueLine(coords))\n\n      // console.log(svg.selectAll('path.line-race'))\n    },\n\n    // Update the line with the current coordinates.\n    updateRaceSummary: function () {\n      var coords = layerGroup.getLayer(this.currentRace.layerId).feature.geometry.coordinates\n\n      x.domain([0, coords.length])\n\n      svg.select('path.line-race')\n          .transition()\n          .attr('d', valueLine(coords))\n\t\t\t\t\t.duration(300)\n    },\n\n    // Move the camera to the specific race\n    updateCamera: function () {\n      var bounds = L.latLngBounds(\n        L.latLng(this.currentRace.start[1], this.currentRace.start[0]),\n        L.latLng(this.currentRace.end[1], this.currentRace.end[0])\n      )\n\n      // Add padding because of the overview\n      map.fitBounds(\n        bounds,\n        {\n          maxZoom: 10,\n          animate: true,\n          paddingTopLeft: [300, 300],\n          paddingBottomRight: [0, 200]\n        }\n      )\n    },\n\n    // Helper to draw circles.\n    circleFactory: function (coords, style) {\n      return L.circle(\n        [coords[1], coords[0]],\n        500,\n        style\n      ).addTo(map)\n    },\n\n    // Helper to find the min and max of the altitude cell.\n    arrayMinMax: function (arr) {\n      let len = arr.length\n      let min = Infinity\n      let max = -Infinity\n      let cell\n\n      while (len--) {\n        cell = arr[len][2]\n        if (cell < min) {\n          min = cell\n        }\n        if (cell > max) {\n          max = cell\n        }\n      }\n\n      return [min, max]\n    }\n  },\n\n  // Triggers when race emits events.\n  events: {\n\n    // On click\n    'race-selected': function (race) {\n      this.highlightFeature(race.stage)\n    }\n  }\n}\n</script>\n\n<style>\n/*.stage-1 { fill: red; }*/\n#mapid {\n  height: 100%;\n  width: 100%;\n}\n\n.start{\n  cursor: pointer;\n}\n\n.race-overview{\n  font-family: 'Lato', sans-serif;\n  font-weight: 300;\n  position: absolute;\n  top: 10px;\n  left: 50%;\n  transform: translateX(-50%);\n  z-index: 1;\n  background: #f5da3f;\n  color: #000;\n  min-width: 450px;\n}\n\n.race-overview p{\n  text-align: center;\n  font-size: 1.250rem;\n  margin: 1em;\n  letter-spacing: 0.1em;\n}\n\n.race-overview p span{\n  display: block;\n  margin: auto;\n  font-size: 1.500rem;\n  text-transform: uppercase;\n  margin-top: 15px;\n  font-weight: 700;\n}\n\n.race-selector{\n  background: rgba(0, 0, 0, 0.1);\n  color: #fff;\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  z-index: 9999;\n  left: 10px;\n}\n\n.navigator{\n  position: absolute;\n  width: 150%;\n  left: 50%;\n  transform: translateX(-50%);\n}\n.navigator p{\n  color: #fff;\n  background: #000;\n  display: inline-block;\n  padding: 1em;\n  margin: 0 -2.7em;\n  cursor: pointer;\n}\n\n.navigator p + p{\n  float: right;\n}\n\n.race-details{\n  font-size: 0;\n  padding-bottom: 10px;\n}\n.race-details span{\n  display: inline-block;\n  width: 50%;\n  text-align: center;\n  font-size: 1.150rem;\n}\n\n#summary{\n  width: 430px;\n  height: 100px;\n  margin: 10px auto 0;\n  display: block;\n}\n\n#summary path, line {\n  stroke: black;\n  stroke-width: 1;\n  fill: none;\n}\n\n#summary .y-axis{\n  stroke: black;\n  font-family: 'Lato', sans-serif;\n  font-size: 10px;\n  font-weight: 300;\n}\n\n#summary .y-axis text{\n  transform: translate(0,-10);\n}\n</style>\n\n\n\n/** WEBPACK FOOTER **\n ** Tdf.vue?75ab3695\n **/","module.exports = \" <tdf></tdf> \";\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/vue-html-loader!./~/vue-loader/lib/selector.js?type=template&index=0!./src/App.vue\n ** module id = 10\n ** module chunks = 1\n **/","module.exports = \" <div class=race-selector v-if=\\\"currentRace != null\\\"> <race v-for=\\\"race in races | orderBy 'stage'\\\" :race=race> </race> </div> <section class=race-overview> <header> <div v-if=\\\"currentRace != null\\\"> <div class=navigator> <p v-show=\\\"previousRace > 0\\\" v-on:click=highlightFeature(previousRace)> Étape {{ previousRace }} ← </p> <p v-show=\\\"nextRace <= races.length\\\" v-on:click=highlightFeature(nextRace)> → Étape {{ nextRace }} </p> </div> <p> Étape {{ currentRace.stage }} <span>{{ currentRace.data.name }}<span> </span></span></p> </div> <div v-else class=start> <p v-on:click=highlightFeature(1)> Tour de France 2016 <span>Cliquez pour commencer</span> </p> </div> </header> <div class=race-details v-show=\\\"currentRace != null\\\"> <span v-if=\\\"currentRace != null\\\"> Distance {{ currentRace.data.distance }} km </span> <span v-if=\\\"currentRace != null\\\"> Dénivelé max {{ elevation }} m </span> <svg id=summary></svg> </div> </section> <div id=mapid></div> \";\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/vue-html-loader!./~/vue-loader/lib/selector.js?type=template&index=0!./src/components/Tdf.vue\n ** module id = 11\n ** module chunks = 1\n **/","module.exports = \" <div v-bind:class=\\\"{ 'active': race.selected }\\\" v-on:click=raceSelected _v-e1b8c030=\\\"\\\"> Étape {{ race.stage }} : {{ race.data.name }} </div> \";\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/vue-html-loader!./~/vue-loader/lib/template-rewriter.js?id=_v-e1b8c030!./~/vue-loader/lib/selector.js?type=template&index=0!./src/components/Race.vue\n ** module id = 12\n ** module chunks = 1\n **/","var __vue_script__, __vue_template__\nrequire(\"!!./../node_modules/extract-text-webpack-plugin/loader.js?{\\\"omit\\\":1,\\\"extract\\\":true,\\\"remove\\\":true}!vue-style-loader!css-loader?sourceMap!./../node_modules/vue-loader/lib/style-rewriter.js!./../node_modules/vue-loader/lib/selector.js?type=style&index=0!./App.vue\")\n__vue_script__ = require(\"!!babel-loader?presets[]=es2015&plugins[]=transform-runtime&comments=false!./../node_modules/vue-loader/lib/selector.js?type=script&index=0!./App.vue\")\n__vue_template__ = require(\"!!vue-html-loader!./../node_modules/vue-loader/lib/selector.js?type=template&index=0!./App.vue\")\nmodule.exports = __vue_script__ || {}\nif (module.exports.__esModule) module.exports = module.exports.default\nif (__vue_template__) {\n(typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports).template = __vue_template__\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/App.vue\n ** module id = 13\n ** module chunks = 1\n **/","var __vue_script__, __vue_template__\nrequire(\"!!./../../node_modules/extract-text-webpack-plugin/loader.js?{\\\"omit\\\":1,\\\"extract\\\":true,\\\"remove\\\":true}!vue-style-loader!css-loader?sourceMap!./../../node_modules/vue-loader/lib/style-rewriter.js?id=_v-e1b8c030&scoped=true!./../../node_modules/vue-loader/lib/selector.js?type=style&index=0!./Race.vue\")\n__vue_script__ = require(\"!!babel-loader?presets[]=es2015&plugins[]=transform-runtime&comments=false!./../../node_modules/vue-loader/lib/selector.js?type=script&index=0!./Race.vue\")\n__vue_template__ = require(\"!!vue-html-loader!./../../node_modules/vue-loader/lib/template-rewriter.js?id=_v-e1b8c030!./../../node_modules/vue-loader/lib/selector.js?type=template&index=0!./Race.vue\")\nmodule.exports = __vue_script__ || {}\nif (module.exports.__esModule) module.exports = module.exports.default\nif (__vue_template__) {\n(typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports).template = __vue_template__\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/components/Race.vue\n ** module id = 14\n ** module chunks = 1\n **/","var __vue_script__, __vue_template__\nrequire(\"!!./../../node_modules/extract-text-webpack-plugin/loader.js?{\\\"omit\\\":1,\\\"extract\\\":true,\\\"remove\\\":true}!vue-style-loader!css-loader?sourceMap!./../../node_modules/vue-loader/lib/style-rewriter.js!./../../node_modules/vue-loader/lib/selector.js?type=style&index=0!./Tdf.vue\")\n__vue_script__ = require(\"!!babel-loader?presets[]=es2015&plugins[]=transform-runtime&comments=false!./../../node_modules/vue-loader/lib/selector.js?type=script&index=0!./Tdf.vue\")\n__vue_template__ = require(\"!!vue-html-loader!./../../node_modules/vue-loader/lib/selector.js?type=template&index=0!./Tdf.vue\")\nmodule.exports = __vue_script__ || {}\nif (module.exports.__esModule) module.exports = module.exports.default\nif (__vue_template__) {\n(typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports).template = __vue_template__\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/components/Tdf.vue\n ** module id = 15\n ** module chunks = 1\n **/"],"sourceRoot":""}